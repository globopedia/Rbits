<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>√Årbitros</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'MuseoModerno', sans-serif; background:#fff; color:#222; margin:20px; }
    h1 { color:#FF0000; text-align:center; }
    .logo { display:block; margin:0 auto 10px; width:100px; }
    select { padding:8px; border-radius:8px; border:2px solid #FF0000; font-size:16px; margin-bottom:20px; }
    .club-card { border:3px solid #FF0000; border-radius:20px; padding:20px; max-width:900px; margin:0 auto; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .club-header { display:flex; align-items:center; gap:15px; border-bottom:2px solid #FF0000; padding-bottom:10px; margin-bottom:10px; }
    .club-header img { width:70px; height:70px; object-fit:contain; }
    h2 { margin:0; color:#FF0000; font-size:22px; }
    .stats { margin-top:20px; }
    .stat-group { margin-bottom:20px; padding:12px; border:1px solid #FF0000; border-radius:12px; background:#fff5f5; }
    .stat-title { font-weight:bold; color:#FF0000; margin-bottom:6px; }
    .hr { border:none; border-top:1px solid #FF0000; margin:8px 0; }
    .partido-card { border:1px solid #ccc; border-radius:6px; padding:6px; margin:4px 0; background:#fafafa; font-size:14px; text-align: center; }
    .acordeon { border: 1px solid #ddd; border-radius: 6px; margin: 6px 0; background: #fefefe; }
    .acordeon-header { background: #eee; padding: 4px 8px; cursor: pointer; font-size: 14px; text-align: right; position: relative; padding-right: 20px; }
    .acordeon-header::after { content: "‚ñæ"; position: absolute; right: 0; transition: transform 0.3s; }
    .acordeon-header.abierto::after { transform: rotate(180deg); }
    .acordeon-body { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease; padding: 8px; }
    .acordeon-body.cerrado { max-height: 0; padding: 0 8px; }
    .resultado1-box, .resultado2-box {
      display: inline-block; width: 16px; height: 28px; font-size: 32px; font-weight: bold;
      line-height: 28px; text-align: center; margin: 2px; padding: 10px 10px;
      border: 3px solid #FF0000; border-radius: 6px; background: #fff5f5;
      vertical-align: middle; min-width: 26px;
    }
    .escudo-huracan, .escudo-rival { width: 50px; height: 50px; object-fit: contain; position: relative; top: 6px; vertical-align: middle; }
    .resultado-con-escudo { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <img src="https://globopedia.github.io/buscador-partidos/logo_globopedia.png" alt="Logo Hurac√°n" class="logo" />
  <h1>üìú √Årbitros</h1>
  <div style="text-align:center;">
    <label>Seleccionar juez: </label>
    <select id="clubSelect"></select>
  </div>
  <div id="clubInfo" class="club-card" style="display:none;"></div>

  <script>
 const √°rbitroURL = "https://globopedia.github.io/Rbits/Rbits.csv?v=" + Date.now();
    const partidosURL = "https://globopedia.github.io/buscador-partidos/Encuentros_Huracan.csv?v=" + Date.now();
    let √°rbitros = [];
    let encuentros = [];

    // Normalizaciones y utilidades
    const norm = (t) => (t || "").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().toLowerCase();
    const cap = (s) => s ? s.charAt(0).toUpperCase() + s.slice(1).toLowerCase() : s;

    function bucketCompetencia(torneo) {
      const t = norm(torneo);
      if (t.includes("libertadores")) return "Copa Libertadores";
      if (t.includes("sudamericana")) return "Copa Sudamericana";
      if (t.includes("argentina")) return "Copa Argentina";
      if (t.includes("superliga")) return "Copa Superliga";
      if (t.includes("maradona")) return "Copa Maradona";
      if (t.includes("supercopa")) return "Supercopa";
      if (t.includes("b nacional") || t.includes("nacional b") || t.includes("nac b")) return "Nacional B";
      if (t.includes("campeonato") || t.includes("liga") || t.includes("torneo") || t.includes("primera")) return "Campeonato";
      if (t.includes("amistoso")) return "Amistoso";
      return "Otros";
    }

    const ORDEN_COMPETENCIAS = ["Copa Libertadores","Copa Sudamericana","Campeonato","Copa Argentina","Copa Superliga","Copa Maradona","Supercopa","Nacional B","Amistoso"];
    const CONDICIONES = ["Local","Neutral","Visitante"];
    const SITUACIONES = ["Victoria","Empate","Derrota"];

    // Cargar ambos CSVs (clubes y encuentros)
    Promise.all([
      fetch(clubesURL).then(r => { if(!r.ok) throw new Error("Clubes CSV no disponible"); return r.text(); }),
      fetch(partidosURL).then(r => { if(!r.ok) throw new Error("Partidos CSV no disponible"); return r.text(); })
    ])
    .then(([csvRbits, csvPartidos]) => {
      √°rbitros = Papa.parse(csvRbits, { header:true, skipEmptyLines:true }).data.map(c => ({
        id: (c.id ?? "").toString().trim(),
        nombre: (c.Nombre ?? c.nombre ?? "").toString().trim(),
        datos: c.Datos ?? c.datos ?? ""
      }));
      
      encuentros = Papa.parse(csvPartidos, { header:true, skipEmptyLines:true }).data.map(p => ({
        Fecha: (p.Fecha ?? "").trim(),
        T√©cnico: (p.T√©cnico ?? "").trim(),
        Condici√≥n: (p.Condici√≥n ?? "").trim(),
        Situaci√≥n: (p.Situaci√≥n ?? "").trim(),
        Resultado1: (p.Resultado1 ?? "").trim(),
        Resultado2: (p.Resultado2 ?? "").trim(),
        Club: (p.Club ?? "").trim(),
        Torneo: (p.Torneo ?? "").trim(),
        Estadio: (p.Estadio ?? "").trim(),
        √Årbitro: (p.√Årbitro ?? "").trim(),
        Hurac√°n: (p.Hurac√°n ?? "").trim(),
        Rival: (p.Rival ?? "").trim(),
        Incidencias: (p.Incidencias ?? "").trim()
      }));

      llenarSelectClubes();
    })
    .catch(err => {
      console.error("Error cargando CSVs:", err);
      alert("No pude cargar los CSV. Revis√° las URLs o el formato en la consola.");
    });

    function llenarSelect√Årbitros() {
      const sel = document.getElementById("clubSelect");
      sel.innerHTML = "<option value=''>-- Seleccionar --</option>";
      clubes.forEach(club => {
        if (club.id && club.club) {
          const opt = document.createElement("option");
          opt.value = club.id;
          opt.textContent = club.club;
          sel.appendChild(opt);
        }
      });
      sel.addEventListener("change", mostrarClub);
    }
 function mostrarClub() {
      const clubId = document.getElementById("clubSelect").value;
      const club = clubes.find(c => (c.id||"").trim() === (clubId||"").trim());
      if (!club) {
        alert("No se encontr√≥ el club seleccionado");
        return;
      }
      const cont = document.getElementById("clubInfo");
      cont.style.display = "block";
      cont.innerHTML = `
        <div class="club-header">
          <img src="${club.escudo}" alt="escudo" />
          <h2>${club.nombre}</h2>
        </div>
        <p><b>Fundaci√≥n:</b> ${club.fundacion}</p>
        <p><b>Direcci√≥n:</b> ${club.direccion}</p>
        <p><b>Web:</b> ${club.web}</p>
        <p><b>Colores:</b> ${club.colores}</p>
        <p><b>T√≠tulos:</b> ${club.titulos}</p>
        <p><b>Estadio:</b> ${club.estadio}</p>
        <p><b>Curiosidades:</b> ${club.curiosidades}</p>
        <div class="stats">
          <h3 style="color:#FF0000;">üìä Historial desde 2007</h3>
          ${renderEstadisticas(club.club)}
        </div>
      `;
    }

    function renderEstadisticas(nombreClub) {
      const clubNorm = norm(nombreClub);
      const delClub = encuentros.filter(p => norm(p.Club) === clubNorm);
      const agg = {};
      for (const e of delClub) {
        const comp = bucketCompetencia(e.Torneo);
        const cond = cap(norm(e.Condici√≥n));
        const sit = cap(norm(e.Situaci√≥n));
        if (!agg[comp]) agg[comp] = {};
        if (!agg[comp][cond]) agg[comp][cond] = { Victoria:0, Empate:0, Derrota:0 };
        if (SITUACIONES.includes(sit)) {
          agg[comp][cond][sit] += 1;
        }
      }
      let html = "";
      for (const comp of ORDEN_COMPETENCIAS) {
        if (!agg[comp]) continue;
        let compHTML = "";
        CONDICIONES.forEach((cond, idx) => {
          const bucket = agg[comp][cond] || { Victoria:0, Empate:0, Derrota:0 };
          const tot = bucket.Victoria + bucket.Empate + bucket.Derrota;
          if (tot === 0) return;
          let bloque = `<div class="stat-title">üìç ${cond}</div><ul>`;
          ["Victoria","Empate","Derrota"].forEach(tipo => {
            const cantidad = bucket[tipo];
            if (cantidad > 0) {
              const icono = tipo==="Victoria"?"‚úÖ":tipo==="Empate"?"ü§ù":"‚ùå";
              bloque += `
                <li>
                  <label>
                    <input type="checkbox" class="chkPartidos" data-comp="${comp}" data-cond="${cond}" data-sit="${tipo}" data-club="${nombreClub}">
                    ${icono} ${tipo}s: ${cantidad}
                  </label>
                  <div class="partidos-lista" style="display:none; margin-left:20px;"></div>
                </li>
              `;
            }
          });
          bloque += "</ul>";
          compHTML += bloque;
          if (idx < CONDICIONES.length - 1) compHTML += `<div class="hr"></div>`;
        });
        if (compHTML) {
          html += `
            <div class="stat-group">
              <div class="stat-title">üèÜ ${comp}</div>
              ${compHTML}
            </div>
          `;
        }
      }
      return html || "<p>Sin datos disponibles</p>";
    }

    // Manejador de checkboxes (muestra partidos por filtro)
    document.addEventListener("change", function(e) {
      if (!e.target.classList.contains("chkPartidos")) return;
      const contenedor = e.target.closest("li").querySelector(".partidos-lista");
      contenedor.innerHTML = "";
      if (e.target.checked) {
        const { comp, cond, sit, club } = e.target.dataset;
        const partidos = encuentros.filter(p =>
          norm(p.Club) === norm(club) &&
          bucketCompetencia(p.Torneo) === comp &&
          cap(norm(p.Condici√≥n)) === cond &&
          cap(norm(p.Situaci√≥n)) === sit
        );
        if (partidos.length) {
          partidos.forEach(p => {
            let bloqueHTML = "";
            if ((p.Condici√≥n || "").toLowerCase() === "visitante") {
              bloqueHTML = `
                <div class="partido-card">
                  ${getTorneoImage(p.Torneo)}
                  <img class="escudo-rival" src="${getEscudo(p.Club)}" alt="${p.Club}" />
                  <div class="resultado2-box">${p.Resultado2}</div>
                  <div class="resultado1-box">${p.Resultado1}</div>
                  <img src="https://globopedia.github.io/buscador-partidos/escudos/Hurac√°n.png" alt="Hurac√°n" class="escudo-huracan">
                  <div><b>${p.Torneo}</b></div>
                  <div><b>Estadio:</b> ${p.Estadio} - <b>√Årbitro:</b> ${p.√Årbitro}</div>
                  <div>
  ${
    p.Estadio && getEstadioImage(p.Estadio)
      ? `<img src="${getEstadioImage(p.Estadio)}" alt="${p.Estadio}" style="max-height:40px; display:block; margin:4px auto;">`
      : ""
  }
</div>
<div><b>${p.Club}:</b> ${p.Rival}</div>
                  <div><b>Hurac√°n:</b> ${p.Hurac√°n}</div>
                  <div>
                    ${ p.Estadio && getEstadioImage(p.Estadio)
                      ? `<img src="${getEstadioImage(p.Estadio)}" alt="${p.Estadio}" style="max-height:40px;">`
                      : `<b>Incidencias:</b>` }
                    ${renderIncidencias(p.Incidencias)}
                  </div>
                </div>
              `;
            } else {
              bloqueHTML = `
                <div class="partido-card">
                  ${getTorneoImage(p.Torneo)}
                  <img src="https://globopedia.github.io/buscador-partidos/escudos/Hurac√°n.png" alt="Hurac√°n" class="escudo-huracan">
                  <div class="resultado1-box">${p.Resultado1}</div>
                  <div class="resultado2-box">${p.Resultado2}</div>
                  <img class="escudo-rival" src="${getEscudo(p.Club)}" alt="${p.Club}" />
                  <div><b>${p.Torneo}</b></div>
                  <div><b>Estadio:</b> ${p.Estadio} - <b>√Årbitro:</b> ${p.√Årbitro}</div>
                  <div>
  ${
    p.Estadio && getEstadioImage(p.Estadio)
      ? `<img src="${getEstadioImage(p.Estadio)}" alt="${p.Estadio}" style="max-height:40px; display:block; margin:4px auto;">`
      : ""
  }
</div>
<div><b>Hurac√°n:</b> ${p.Hurac√°n}</div>
                  <div><b>${p.Club}:</b> ${p.Rival}</div>
                    ${ p.Estadio && getEstadioImage(p.Estadio)
                      ? `<img src="${getEstadioImage(p.Estadio)}" alt="${p.Estadio}" style="max-height:40px;">`
                      : `<b>Incidencias:</b>` }
                    ${renderIncidencias(p.Incidencias)}
                </div>
              `;
            }
            contenedor.innerHTML += `
              <div class="acordeon">
                <div class="acordeon-header">${p.Fecha}</div>
                <div class="acordeon-body cerrado">${bloqueHTML}</div>
              </div>
            `;
          });
        } else {
          contenedor.innerHTML = "<i>No hay partidos registrados</i>";
        }
        contenedor.style.display = "block";
      } else {
        contenedor.style.display = "none";
      }
    });

    // Toggle acorde√≥n
    document.addEventListener("click", function(e) {
      if (e.target.classList.contains("acordeon-header")) {
        const body = e.target.nextElementSibling;
        body.classList.toggle("cerrado");
        e.target.classList.toggle("abierto");
      }
    });

    function getEscudo(nombreClub) {
      const c = clubes.find(cl => norm(cl.club) === norm(nombreClub));
      return c ? c.escudo : "";
    }

    function renderIncidencias(texto) {
      if (!texto) return "";
      return texto
        .replace(/GOL/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgi3GyVjBR-e_IN4mWVAuZofChVOj763GApXwzanoEJDUTysF1K9gf3N5qBCoDJ-ahi8wRkrZ3FCbl0ovTEjXyjFjFEWYF1MZ7YvHrq0bD5eQ7GsJPOkpLSC-k4zpZ1CbnyKVtoYlb6JWXByKkd0VAHuN1hy8P9LBz2fhn5e3Um_X-m4U9WLo9pQP428Fj4/s320/GolR.png' alt='gol' style='width:20px;height:20px;'>")
        .replace(/EXP/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgx8a6PCkGhKR9WTnh2NNWLMBDOIKWsNisSChpxN2NayjM5Z6YBIZmv52PvduZawIBBh_g5Pq56LdvjG8X1gSCud2q6NYS_NGOh7nAPaxUy_nC1YCcZJOgy2DeTZPRkqRgb1_HbpJshh-7o3MoW8Z3h8tBa8UZ153n5CzriOyvsSIxM6FsCbn-n115KC5Ln/s320/Roja.png' alt='expulsi√≥n' style='width:20px;height:20px;'>")
        .replace(/ATA/g, "<img src='https://blogger.googleusercontent.com/img/a/AVvXsEjygOwijhQ1dRIh6BPFrQu7EKOUShS0RLEVmPhCJSANGWOaNzvVmcbV03ZW0ZF5Npefl5r3P8iU6WjXRaSL80QYazspsJ4-nzA8pv4FqBwgu1Jr0wDw2iEPMvnVgK0nvRLeZmGYuVW8epSVTyyND28aoQRd9wD9yxKJWBuPOhOoVz-cUgpbM702W2ZlpsF7=w95-h79' alt='golh' style='width:20px;height:20px;'>")
        .replace(/PEN/g, "<img src='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEho-erXGKkNZ7MaZWOtZw-ru0AnJwAlzHqnl5fKLmUAn_QtAMAbXgGMsqh21htJ2XSePyqAMAq4Xce1RkwkrqrA4Hw312mYcXhXMVW-m64vRS_lKTNgnBNvCzPZsPV3eEk_QclWiNZ9n9pvAQSiscTyp94vbN_h6aMeQ_nwTdBSdXGn5B3HW3A-sj_4Bw1j/s320/Penales.png' alt='pen' style='width:20px;height:20px;'>");
    }

    function getEstadioImage(estadio) {
      if (!estadio) return "";
      // Limpiamos nombre para intentar coincidir con archivos en la carpeta Estadios
      const fileName = estadio
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/\./g, "")
        .replace(/\s+/g, "") + ".png";
      return "https://globopedia.github.io/buscador-partidos/Estadios/" + fileName;
    }

    function getTorneoImage(nombreTorneo) {
      if (!nombreTorneo) return "";
      const texto = nombreTorneo.toLowerCase();
      const torneosDisponibles = [
        "Apertura 2007", "Clausura 2008", "Apertura 2008", "Clausura 2009",
        "Apertura 2009", "Clausura 2010", "Apertura 2010", "Clausura 2011",
        "Nacional B 11-12", "Copa Argentina 2012","Copa Argentina 2013","Copa Argentina 2014",
        "Copa Argentina 2015","Copa Argentina 2016","Copa Argentina 2017","Copa Argentina 2018",
        "Copa Argentina 2019","Copa Argentina 2020","Copa Argentina 2022","Copa Argentina 2023",
        "Copa Argentina 2024","Copa Argentina 2025", "Nacional B 12-13", "Nacional B 13-14",
        "Nacional B 2014", "Supercopa 2015", "Campeonato 2015", "Libertadores 2015",
        "Sudamericana 2015", "Campeonato 2016", "Libertadores 2016", "Campeonato 16-17",
        "Sudamericana 2017", "SAF 17-18", "SAF 18-19", "SAF 19-20", "Copa Maradona 2020",
        "Libertadores 2019", "Sudamericana 2020", "Torneo-LPF 2021", "Torneo-LPF 2022", "Torneo-LPF 2023",
        "Copa-LPF 2021", "Copa-LPF 2022", "Copa-LPF 2023", "Copa-LPF 2024", "Torneo-LPF 2024",
        "Apertura-LPF 2024", "Clausura-LPF 2025", "Libertadores 2023", "Sudamericana 2023", "Sudamericana 2025"
      ];
      for (const t of torneosDisponibles) {
        if (texto.includes(t.toLowerCase())) {
          const fileName = encodeURIComponent(t) + ".png";
          return `<img src="https://globopedia.github.io/buscador-partidos/Torneos/${fileName}" alt="${t}" style="max-height:40px; display:block; margin:4px auto;">`;
        }
      }
      return "";
    }

  // Env√≠a la altura al padre
  function postAltura() {
    const altura = document.documentElement.scrollHeight || document.body.scrollHeight;
    parent.postMessage({ type: 'ajustarAltura', altura: altura }, '*');
  }

  // Env√≠o inicial y en resize
  window.addEventListener('load', postAltura);
  window.addEventListener('resize', postAltura);

  // Detecta cambios din√°micos en el DOM (ej. menus, contenido que aparece)
  const mo = new MutationObserver(() => {
    postAltura();
  });
  mo.observe(document.body, { childList: true, subtree: true, attributes: true, characterData: true });

  // Asegura recalcular cuando cargan im√°genes
  document.querySelectorAll('img').forEach(img => {
    if (!img.complete) img.addEventListener('load', postAltura);
  });

  // Opcional: reenv√≠o peri√≥dico corto como fallback
  let contador = 0;
  const fallback = setInterval(() => {
    postAltura();
    if (++contador > 10) clearInterval(fallback); // 10 env√≠os y corta
  }, 500);
  </script>
</body>
</html>
